<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous" />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
    <title>Recept aanmaken</title>
    <link rel="stylesheet" href="main.css">
    <script src="algemeen.js"></script>
    <script>
        window.onload = function () {
            maakmenubalk();
        }
    </script>
    <style>
        .div-standard {
            margin-left: 5%;

        }

        .grid-container-element {
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-gap: 20px;
            border: 1px solid black;
            width: 55%;
            margin-left: 5%;
        }

        .grid-child-element1 {
            margin-left: 10%;
            
        }

        .grid-child-element2 {
            margin-left: 10%;
            margin-right: 10%;
            
        }

        .recept-header {
            display: flex;
            justify-content: center;
            font-size: 5em;
            font-weight: bold;
            padding-top: 1%;
            text-transform: capitalize;
        }
    </style>


    <script>
        function aanmakenrecept() {
            let naamrecept = document.getElementById("naamreceptinvoer").value;
            let descriptionrecept = document.getElementById("descriptionreceptinvoer").value;
            let difficultyrecept = document.getElementById("difficultyinvoer").value;
            console.log(naamrecept)
            console.log(descriptionrecept)
            let recept = {};
            recept.naam = naamrecept;
            recept.description = descriptionrecept;
            recept.difficulty = difficultyrecept;
            let receptjson = JSON.stringify(recept);
            fetch(backendurl + "recepttevoegen2temp", {
                method: 'POST', // Specify the method
                headers: {
                    'Content-Type': 'application/json', // Specify the content type
                    // Add other headers if required
                },
                body: receptjson
            }).then(r => r.text())
                .then(d => plaatsreceptid(d))
        }
        function plaatsreceptid(id) {
            document.getElementById("receptidinput").value = id;
            document.getElementById("vervolgstappendiv").hidden = false;
            document.getElementById("hiddenatstart").hidden = false;
            document.getElementById("alsohiddenatstart").hidden = false;
            document.getElementById("alsohiddenatstart").innerHTML = document.getElementById("naamreceptinvoer").value;
            toonreceptinhoud();
        }
        function staptoevoegen() {
            console.log("stap toevoegen");
            let receptid = document.getElementById("receptidinput").value;
            let stap = {};
            stap.Stapbeschrijving = document.getElementById("stapomschrijvinginput").value;
            stap.volgorde = document.getElementById("stapvolgordeinput").value;
            let stapjson = JSON.stringify(stap);
            console.log(stapjson);
            fetch(backendurl + "staptoevoegenaanrecept/" + receptid, {
                method: 'POST', // Specify the method
                headers: {
                    'Content-Type': 'application/json', // Specify the content type
                    // Add other headers if required
                },
                body: stapjson
            }).then(r => r.text())
                .then(d => toonreceptinhoud())
        }

        function ingredienttoevoegen() {
            console.log("ingredient toevoegen");
            let receptid = document.getElementById("receptidinput").value;
            let ingredient = {};
            ingredient.naam = document.getElementById("ingredientomschrijvinginput").value;
            ingredient.volgorde = document.getElementById("ingredientomschrijving").value;
            ingredient.hoeveelheid = document.getElementById("ingredienthoeveelheid").value;
            let ingredientjson = JSON.stringify(ingredient);
            console.log(ingredientjson);
            fetch(backendurl + "ingredienttoevoegenaanrecept/" + receptid, {
                method: 'POST', // Specify the method
                headers: {
                    'Content-Type': 'application/json', // Specify the content type
                    // Add other headers if required
                },
                body: ingredientjson
            }).then(r => r.text())
                .then(d => toonreceptinhoud2())
        }

        function tagtoevoegen() {
            console.log("tag toevoegen");
            let receptid = document.getElementById("receptidinput").value;
            let tag = {};
            tag.naam = document.getElementById("taginput").value;
            let tagjson = JSON.stringify(tag);
            console.log(tagjson);

            fetch(backendurl + "tagtoevoegen/" + receptid, {
                method: 'POST', // Specify the method
                headers: {
                    'Content-Type': 'application/json', // Specify the content type
                    // Add other headers if required
                },
                body: tagjson
            }).then(r => r.text())
                .then(d => toonreceptinhoud())
        }

        function toonreceptinhoud() {
            console.log("toon receptinhoud");
            var iddiejeuitguihaalt = document.getElementById("receptidinput").value;
            fetch(backendurl + "receptdetails2temp/" + iddiejeuitguihaalt)
                .then(r => r.json())
                .then(d => verwerkafbeelding(d))
        }

        function toonreceptinhoud2() {
            console.log("toon receptinhoud2");
            var iddiejeuitguihaalt = document.getElementById("receptidinput").value;
            fetch(backendurl + "receptdetails2temp/" + iddiejeuitguihaalt)
                .then(r => r.json())
                .then(d => verwerkafbeelding2(d))
        }

        let ingredienten = []
        function verwerkafbeelding2(heelrecept2) {
            console.log(heelrecept2)
            document.getElementById("ingredientenpreview").innerHTML = "Ingredienten voor recept " + document.getElementById("naamreceptinvoer").value + ":";
            for (let x = 0; x < heelrecept2.length; x++) {
                if (heelrecept2[0].inaam == null || findingredient(heelrecept2[x].inaam)) {
                    console.log("null");
                } else {
                    ingredienten.push([heelrecept2[x].inaam, heelrecept2[x].ivolgorde, heelrecept2[x].ihoeveelheid])
                }
            }
            tooningredienten();
        }
        function findingredient(destring) {
            for (let y = 0; y < ingredienten.length; y++) {
                if (destring == ingredienten[y][0]) {
                    return true;
                }
            }
            return false;
        }

        let stappen = []
        function verwerkafbeelding(heelrecept) {
            console.log(heelrecept)
            document.getElementById("receptnaampreview").innerHTML = "Stappen voor de bereiding van " + document.getElementById("naamreceptinvoer").value + ":";
            for (let x = 0; x < heelrecept.length; x++) {
                if (heelrecept[0].Stapbeschrijving == null || findstap(heelrecept[x].Stapbeschrijving)) {
                    console.log("null");
                } else {
                    stappen.push([heelrecept[x].Stapbeschrijving, heelrecept[x].volgorde])
                }
            }
            toonstappen();
        }

        function findstap(destring) {
            for (let y = 0; y < stappen.length; y++) {
                if (destring == stappen[y][0]) {
                    return true;
                }
            }
            return false;
        }
        function tooningredienten() {
            console.log(ingredienten)
            document.getElementById("ingredientenlijst").innerHTML = "";
            document.getElementById("previewtext").innerHTML = "Preview voor recept " + document.getElementById("naamreceptinvoer").value;
            for (let x = 0; x < ingredienten.length; x++) {
                document.getElementById("ingredientenlijst").innerHTML += "<br>" + ingredienten[x][1] + " - " + ingredienten[x][0] + " " + ingredienten[x][2]
            }
        }

        function toonstappen() {
            document.getElementById("stappenlijst").innerHTML = "";
            for (let x = 0; x < stappen.length; x++) {
                document.getElementById("stappenlijst").innerHTML += "<br>" + stappen[x][1] + " - " + stappen[x][0]
            }
        }
    </script>
</head>

<body>
    <div id="menubalk"></div>
    <br><br><br><br><br>
    <div class="recept-header" id="alsohiddenatstart" hidden></div>
    <br>
    <div class="div-standard">
        Naam recept:&ensp;&emsp;&ensp;&emsp;&ensp;&emsp;&ensp;&ensp;&ensp; Beschrijving:&ensp;&emsp;&ensp;&emsp;&ensp;&emsp;&ensp;&ensp;&ensp;&ensp;Bereidingstijd:<br>
        <input id="naamreceptinvoer">&ensp;<input id="descriptionreceptinvoer">&ensp;<input id="difficultyinvoer"><br>
        <button onclick="aanmakenrecept()">Maak recept aan</button>
    </div>
    <br>
    <div class="grid-container-element">
        <div class="grid-child-element1" id="vervolgstappendiv" hidden>
            idrecept : <br>
            <input id="receptidinput"><br>
            Tag toevoegen: <br>
            <textarea id="taginput"></textarea><br>
            <button onclick="tagtoevoegen()">Voeg tag toe</button><br><br>
            Ingredient toevoegen: <br>
            <textarea id="ingredientomschrijvinginput"></textarea><br>
            Volgorde van ingredient: <br>
            <input id="ingredientomschrijving"><br>
            Hoeveelheid van ingredient: <br>
            <input id="ingredienthoeveelheid"><br>
            <button onclick="ingredienttoevoegen()">Voeg ingredient toe</button><br><br>
            Stap omschrijving toevoegen:<br>
            <textarea id="stapomschrijvinginput"></textarea><br>
            Stap volgorde:<br>
            <input id="stapvolgordeinput"><br>
            <button onclick="staptoevoegen()">Voeg stap toe</button><br><br>
            Upload een afbeelding voor deze stap:<br>
            <input type="file" id="fileInput" /><br>
            <button onclick="uploadFile()">Upload Afbeelding</button>

        </div>
        <div class="grid-child-element2" id="hiddenatstart" hidden>
            <h3 id="previewtext"></h3>
            <div>
                <div id="ingredientenpreview">

                </div>
                <div id="ingredientenlijst">

                </div><br><br>
                <div id="receptnaampreview">

                </div>
                <div id="stappenlijst">

                </div>
            </div>
        </div>
    </div>

</body>
<div id="footerbalk"></div>

</html>